# ============================================
# Legacy 데이터 정제 및 UDI 매칭 정책
# ============================================

_base: "../base.yaml"

# ------------------------------------------------
# 퍼지 매칭 (제조사 정규화)
# ------------------------------------------------
fuzzy_matching:
  threshold: 90        # 0–100
  algorithm: "ratio"   # 향후 확장 대비 (ex. ratio, partial, token_sort)

# ------------------------------------------------
# 제조사 데이터 준수율
# ------------------------------------------------
manufacturer_compliance:
  low_compliance_threshold: 0.50

# ------------------------------------------------
# Score 기반 매칭 정책
# ------------------------------------------------
score_matching:
  # score 단계 (내림차순 평가)
  score_levels: [3, 2, 1]

  # 항목별 가중치
  weights:
    brand: 1
    model_number: 1
    catalog_number: 1

  # Primary 후보 허용 개수
  require_unique_primary: true   # n_primary == 1

# ------------------------------------------------
# 매칭 타입 (enum 성격)
# ------------------------------------------------
match_types:
  direct: "udi_direct"
  secondary: "udi_secondary"
  meta: "meta_match"
  udi_no_match: "udi_no_match"
  no_match: "no_match"
  not_in_mapping: "not_in_mapping"

# ------------------------------------------------
# 신뢰도 매핑
# ------------------------------------------------
confidence:
  levels:
    udi_direct: "HIGH"
    udi_secondary: "HIGH"
    meta_match: "MEDIUM"
    udi_no_match: "LOW"
    no_match: "VERY_LOW"
    not_in_mapping: "VERY_LOW"

# ------------------------------------------------
# 날짜 필드 우선순위
# ------------------------------------------------
date_fields:
  maude_priority:
    - "date_of_event"
    - "date_received"
    - "date_report"
    - "device_0_date_received"

  udi:
    - "publish_date"

# ------------------------------------------------
# 그룹화 / 비교 키
# ------------------------------------------------
grouping:
  device_identity:
    - "manufacturer"
    - "brand"
    - "model_number"
    - "catalog_number"

# ------------------------------------------------
# Join 설정
# ------------------------------------------------
joining:
  key_column: "udi_di"

# ------------------------------------------------
# 임시 파일 관리
# ------------------------------------------------
temp_files:
  directory: "temp"   # base.yaml의 paths.local.temp 기준
  cleanup:
    on_success: true
    on_error: false
