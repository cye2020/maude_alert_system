# 대시보드 레이아웃 표준화 설계안

**작성일**: 2025-12-27
**목적**: 모든 탭의 일관된 레이아웃 구조 정의

---

## 📊 현재 문제점

### 발견된 불일치 사항

| 항목 | Overview | EDA | Spike | Cluster | 문제점 |
|------|----------|-----|-------|---------|--------|
| **필터 배지 위치** | ✅ 상단 | ✅ 상단 | ✅ 상단 | ✅ 상단 | 일관됨 |
| **북마크 기능** | ❌ 없음 | ✅ 있음 | ❌ 없음 | ❌ 없음 | **EDA만 있음** |
| **인사이트 위치** | ❌ 없음 | 📍 상단 | 📍 최상단 | 📍 별도 탭 | **제각각** |
| **메트릭 표시** | 4개 | 없음/섹션별 | 7개 | 4개/탭별 | **일관성 없음** |
| **탭 구조** | ❌ 없음 | 섹션 내 | ❌ 없음 | 최상위 | **일관성 없음** |
| **구분선** | `---` | `---` | `divider()` | `---` | **혼재** |
| **테이블 위치** | ❌ 없음 | 섹션별 | 하단 | expander | **제각각** |

### 사용자 경험 문제
1. ❌ 각 탭마다 **다른 구조**라서 학습 곡선이 높음
2. ❌ 인사이트가 어디 있는지 **예측 불가능**
3. ❌ 어떤 탭은 탭 구조, 어떤 탭은 단일 페이지 → **일관성 부재**
4. ❌ 필터 북마크가 EDA만 있어서 **기능 위치 예측 불가능**

---

## ✅ 표준 레이아웃 구조 설계

### 🎯 설계 원칙

1. **일관성**: 모든 탭이 동일한 기본 구조를 따름
2. **예측 가능성**: 사용자가 요소의 위치를 예측할 수 있음
3. **유연성**: 각 탭의 특성에 맞게 섹션 추가/제거 가능
4. **확장성**: 새로운 탭 추가 시 동일한 템플릿 적용

---

### 📐 표준 레이아웃 구조 (8단계)

```
┌─────────────────────────────────────────────────────┐
│ 1️⃣ 제목 (Title)                                      │
│    st.title(DisplayNames.FULL_TITLE_XXX)            │
├─────────────────────────────────────────────────────┤
│ 2️⃣ 필터 요약 배지 + 북마크 (선택적)                    │
│    render_filter_summary_badge(...)                │
│    render_bookmark_manager(...) [선택적]             │
│    st.markdown("---")                               │
├─────────────────────────────────────────────────────┤
│ 3️⃣ 핵심 인사이트 (선택적)                              │
│    st.info/warning/error/success                    │
│    자동 발견된 중요 정보, 경고, 권장사항               │
│    st.markdown("---")                               │
├─────────────────────────────────────────────────────┤
│ 4️⃣ 핵심 메트릭 (4개 고정)                              │
│    cols = st.columns(4)                             │
│    각 탭의 가장 중요한 지표 4개                        │
│    st.markdown("---")                               │
├─────────────────────────────────────────────────────┤
│ 5️⃣ 메인 시각화 (탭 또는 섹션)                          │
│    탭별 특성에 맞는 주요 차트/분석                     │
│    - 단일 차트                                       │
│    - 또는 st.tabs()로 여러 뷰                         │
│    st.markdown("---")                               │
├─────────────────────────────────────────────────────┤
│ 6️⃣ 상세 분석 섹션 (선택적, 반복 가능)                  │
│    st.subheader("섹션 제목")                         │
│    차트 + 설명                                       │
│    st.markdown("---")                               │
├─────────────────────────────────────────────────────┤
│ 7️⃣ 데이터 테이블 + 다운로드                            │
│    st.subheader("상세 데이터")                       │
│    st.dataframe(...)                                │
│    render_download_button(...)                      │
│    st.markdown("---")                               │
├─────────────────────────────────────────────────────┤
│ 8️⃣ 추가 인사이트/권장사항 (선택적)                      │
│    with st.expander("💡 분석 요약 및 권장사항"):       │
│        - 요약                                        │
│        - 권장사항                                    │
└─────────────────────────────────────────────────────┘
```

---

### 🔧 각 단계별 상세 설명

#### 1️⃣ 제목 (필수)
```python
st.title(DisplayNames.FULL_TITLE_XXX)
```
- 모든 탭 동일한 위치
- DisplayNames 사용

#### 2️⃣ 필터 요약 + 북마크 (필터 요약 필수, 북마크 선택)
```python
# 북마크 (복잡한 필터가 있는 탭만)
if has_bookmark:
    render_bookmark_manager(filters)

# 필터 요약 (모든 탭)
render_filter_summary_badge(...)
st.markdown("---")
```

**북마크 기능 제공 탭**:
- ✅ EDA (복잡한 필터)
- ✅ Spike (복잡한 필터)
- ❌ Overview (간단한 필터)
- ❌ Cluster (날짜만)

#### 3️⃣ 핵심 인사이트 (선택적)
```python
# 자동 발견된 중요 정보
st.error("⚠️ 위험: ...")
st.warning("📢 주의: ...")
st.info("💡 인사이트: ...")
st.success("✅ 정상: ...")
st.markdown("---")
```

**인사이트 제공 탭**:
- ✅ Spike (최상단 - 가장 중요)
- ✅ EDA (상단)
- ⚠️ Cluster (별도 탭 → **상단으로 이동 제안**)
- ❌ Overview (인사이트 없음)

#### 4️⃣ 핵심 메트릭 (필수, 4개 고정)
```python
cols = st.columns(4)
with cols[0]:
    st.metric("지표1", value1, delta1)
# ... (4개)
st.markdown("---")
```

**각 탭별 핵심 메트릭 (4개)**:

- **Overview**:
  1. 총 보고서 수
  2. 가장 치명적인 결함 유형
  3. 중대 피해 발생률
  4. 제조사 결함 확정률

- **EDA**:
  1. 총 보고서 수
  2. 평균 월별 보고 건수
  3. 사망률
  4. 중증 부상률

- **Spike**:
  1. 탐지된 스파이크 수
  2. 평균 탐지 방법 수
  3. 최대 급증률
  4. 신규 스파이크 수

- **Cluster**:
  1. 전체 케이스 수
  2. 사망 건수
  3. 중증 부상 건수
  4. 클러스터 수

#### 5️⃣ 메인 시각화
- 각 탭의 **핵심 차트/분석**
- 복잡한 경우 `st.tabs()` 사용 가능

#### 6️⃣ 상세 분석 섹션 (선택적, 반복 가능)
```python
st.subheader("📊 섹션 제목")
# 차트
# 설명
st.markdown("---")
```

#### 7️⃣ 데이터 테이블 + 다운로드 (선택적)
```python
st.subheader("📋 상세 데이터")
st.dataframe(df, height=600)
render_download_button(df, filename_prefix="tab_name")
st.markdown("---")
```

#### 8️⃣ 추가 인사이트/권장사항 (선택적)
```python
with st.expander("💡 분석 요약 및 권장사항", expanded=False):
    st.markdown("### 주요 발견사항")
    st.markdown("- ...")
    st.markdown("### 권장사항")
    st.markdown("- ...")
```

---

## 🛠️ 적용 계획

### Option A: 멀티페이지 vs 탭 구조

**현재**: 탭 구조 (st.segmented_control)

**제안**: **탭 구조 유지** (변경 없음)

**이유**:
- ✅ 상태 관리가 단순함 (session_state 공유)
- ✅ 필터 공유가 용이함
- ✅ 페이지 이동 없이 빠른 전환
- ❌ 멀티페이지: URL 관리, 상태 유지 복잡도 증가

---

### Option B: Cluster 탭의 인사이트 위치

**현재**: 별도 탭 (4개 탭 중 하나)

**제안**: 두 가지 옵션

#### 옵션 1: 인사이트를 상단으로 이동 (추천)
```python
st.title("🔍 클러스터 분석")
render_filter_summary_badge(...)
st.markdown("---")

# 핵심 인사이트 (상단 배치)
st.info("💡 클러스터 3에서 높은 사망률 발견")
st.warning("⚠️ 클러스터 5에서 급증 패턴 감지")
st.markdown("---")

# 메트릭
cols = st.columns(4)
...

# 메인 시각화 (탭 구조)
tab1, tab2, tab3 = st.tabs(["개별 분석", "클러스터 비교", "전체 개요"])
```

**장점**:
- 다른 탭과 일관성 유지
- 인사이트를 먼저 보여줌

**단점**:
- 현재 탭 구조를 일부 변경해야 함

#### 옵션 2: 인사이트 탭 유지 (현재 구조)
```python
# 현재처럼 "인사이트" 탭을 4번째 탭으로 유지
tab1, tab2, tab3, tab4 = st.tabs(["개별 분석", "클러스터 비교", "전체 개요", "💡 인사이트"])
```

**장점**:
- 변경 최소화

**단점**:
- 다른 탭과 구조가 다름

**💡 추천**: **옵션 1 (인사이트 상단 이동)**

---

### Option C: 북마크 기능 확대

**현재**: EDA만 북마크 기능 있음

**제안**: Spike 탭에도 북마크 추가

**이유**:
- Spike 탭도 필터가 복잡함 (window, z_threshold, correction 등)
- 사용자가 자주 사용하는 설정을 저장할 필요 있음

**적용 탭**:
- ✅ EDA (현재)
- ✅ Spike (추가)
- ❌ Overview (필터 간단)
- ❌ Cluster (필터 간단)

---

### Option D: 구분선 통일

**현재**: `st.markdown("---")` vs `st.divider()` 혼재

**제안**: `st.markdown("---")` 통일

**이유**:
- 대부분의 탭이 이미 사용 중
- 일관성 유지

---

## 📋 구현 단계

### Phase 1: 공통 함수 확장
- `render_bookmark_manager()` → 범용 함수로 개선
- `render_insights_section()` 추가
- `render_standard_metrics()` 추가

### Phase 2: 각 탭별 적용
1. **Overview 탭**
   - 메트릭 위치 조정 (이미 4개 있음)
   - 구분선 확인
   - 테이블/다운로드 없음 (유지)

2. **EDA 탭**
   - 인사이트 위치 확인 (이미 상단)
   - 메트릭 추가 (현재 없음 → 4개 추가)
   - 섹션별 구분선 확인

3. **Spike 탭**
   - 북마크 기능 추가
   - 메트릭 확인 (이미 7개 → 4개로 조정?)
   - 구분선 통일 (`divider()` → `---`)

4. **Cluster 탭**
   - 인사이트 탭 → 상단 섹션으로 이동
   - 탭 구조 조정 (4개 → 3개)
   - 메트릭 위치 조정

### Phase 3: 검증
- 모든 탭 구조 일관성 확인
- 사용자 경험 테스트

---

## ❓ 사용자 승인 필요 사항

아래 항목에 대해 승인을 부탁드립니다:

### 1. 멀티페이지 vs 탭 구조
- [ ] **탭 구조 유지** (현재 유지)
- [ ] 멀티페이지로 전환

### 2. Cluster 탭 인사이트 위치
- [ ] **옵션 1: 인사이트를 상단으로 이동** (추천)
- [ ] 옵션 2: 현재처럼 별도 탭 유지

### 3. 북마크 기능 확대
- [ ] **Spike 탭에 북마크 추가** (추천)
- [ ] EDA만 유지

### 4. 핵심 메트릭 개수
- [ ] **모든 탭 4개로 통일** (추천)
- [ ] 탭별로 유연하게 (Spike는 7개 유지)

### 5. 구분선 통일
- [ ] **`st.markdown("---")` 통일** (추천)
- [ ] `st.divider()` 통일
- [ ] 혼용 허용

---

## 📝 예상 결과

### 적용 후 구조

모든 탭이 다음 구조를 따름:

```
제목
├─ 필터 요약 + 북마크 (선택)
├─ 구분선
├─ 핵심 인사이트 (선택)
├─ 구분선
├─ 핵심 메트릭 (4개)
├─ 구분선
├─ 메인 시각화
├─ 구분선
├─ 상세 분석 섹션들
├─ 구분선
├─ 데이터 테이블 + 다운로드 (선택)
└─ 추가 인사이트 (선택)
```

### 사용자 경험 개선

- ✅ **예측 가능성**: 인사이트는 항상 상단, 메트릭은 항상 4개, 테이블은 항상 하단
- ✅ **일관성**: 모든 탭이 동일한 흐름
- ✅ **학습 곡선 감소**: 한 번 배우면 모든 탭에서 동일
- ✅ **유지보수 용이**: 새로운 탭 추가 시 템플릿 재사용

---

**작성자**: Claude Sonnet 4.5
**작성일**: 2025-12-27
