# ============================================
# 데이터 클린징 설정
# ============================================

# Null Flavor 패턴
null_flavor:
  op_type: 'delete'
  patterns:
    # 단어 경계 매칭
    - '\bUNKNOWN\b'
    - '\bUNKOWN\b'
    - '\bNULL\b'
    - '\bNONE\b'
    - '\bNIL\b'
    - '\bN\.A\.?\b'
    - '\bNOT\s+AVAILABLE\b'
    - '\bNOT\s+SPECIFIED\b'
    - '\bNOT\s+PROVIDED\b'
    - '\bUNAVAILABLE\b'
    - '\bUNSPECIFIED\b'
    - '\bMISSING\b'
    # 정확 매칭
    - '^N/A$'
    - '^NA$'
    - '^NI$'
    - '^UNK$'
    - '^UKN$'
    - '^NO[\s_]?DATA$'
    - '^EMPTY$'
    # HL7 Null Flavor
    - '^NASK$'
    - '^ASKU$'
    - '^TRC$'
    - '^QS$'
    - '^MSK$'
    - '^NAV$'
    - '^INV$'
    - '^OTH$'
    - '^PINF$'
    - '^NINF$'
    - '^UNC$'
    - '^DER$'

# MAUDE 데이터의 정제 패턴
maude:
  # UDI_DI 컬럼의 정제 패턴
  udi_di:
    remove_countries: false
    clean_default: false
    clean:
      - op_type: 'remove'
        patterns: 
          - '^\\(\\d{2}\\)'
          - '\\(\\d{2}\\).*'
          - '^\\d*\\+'
          - '[^a-zA-Z0-9]'
      - {{ null_flavor }}
      - op_type: 'delete'
        patterns: 
          - '^$'
          - '^0+$'
          - '^N$'
          - '^X+$'
          - '^.{2,3}$'
          - '^.{31,}$'

# UDI 데이터의 정제 패턴
udi:
  udi_di:
    remove_countries: false
    clean_default: false
    clean:
      - op_type: 'remove'
        patterns: 
          - '^\\(\\d{2}\\)'
          - '\\(\\d{2}\\).*'
          - '^\\d*\\+'
          - '[^a-zA-Z0-9]'
      - {{ null_flavor }}
      - op_type: 'delete'
        patterns: 
          - '^$'
          - '^0+$'
          - '^N$'
          - '^X+$'
          - '^.{2,3}$'
          - '^.{31,}$'

# 텍스트 정규화
text_normalization:
  trim_whitespace: true
  collapse_spaces: true
  remove_non_printable: true
  normalize_quotes: true
  
  # 대소문자 변환 (특정 컬럼만)
  uppercase_columns:
    - "manufacturer_d_name"
    - "report_source_code"

# UDI 추출
udi_extraction:
  extract_di_from_public: true
  
  di_patterns:
    - "\\(01\\)(\\d{14})"          # GS1
    - "\\+\\$\\$\\+(.*?)\\+\\$"    # HIBCC
    - "=([0-9A-Z]{14,})"           # ICCBBA

# 날짜 통합
date_coalescing:
  # 보고 날짜 우선순위
  report_date_priority:
    - "date_of_event"
    - "date_received"
    - "date_report"
    - "device_0_date_received"
  
  # UDI 발행 날짜
  udi_publish_date_priority:
    - "publish_date"
    - "date_record_created"
  
  # 날짜 검증
  validation:
    min_year: 1990
    max_year: 2030
    invalid_action: "set_null"

# MDR 텍스트 처리
mdr_text_cleaning:
  columns:
    - "mdr_text_0_text"
    - "mdr_text_1_text"
  
  operations:
    - "remove_html_tags"
    - "remove_extra_whitespace"
    - "normalize_line_breaks"
  
  # 텍스트 특징 추출
  extract_features:
    - "text_length"
    - "word_count"